{% extends 'base.html' %}

{% block content %}
<header class="mb-16 text-center">
    <h2 class="text-5xl font-bold mb-4">Consult the Archives</h2>
    <p class="text-xl italic opacity-70">Seek out new volumes to add to your personal shelves.</p>
</header>

<div class="max-w-3xl mx-auto mb-20">
    <form action="{{ url_for('search') }}" method="GET" class="relative group">
        <input type="text" name="q" value="{{ query or '' }}" placeholder="Search by title, author, or ISBN..."
            class="w-full pl-8 pr-32 py-5 bg-transparent border-b-2 border-black/10 focus:border-black/40 transition-soft text-2xl outline-none italic placeholder:opacity-30">
        <button type="submit"
            class="absolute right-0 top-1/2 -translate-y-1/2 text-sm uppercase tracking-widest font-bold hover:italic transition-soft px-4 py-2">Search</button>
    </form>
</div>

{% if results %}
<div class="grid grid-cols-1 md:grid-cols-2 gap-16">
    {% for book in results %}
    <div class="flex gap-8 group">
        <div class="w-40 flex-shrink-0">
            <div class="aspect-[2/3] shadow-xl vintage-border overflow-hidden bg-stone-200">
                {% if book.thumbnail %}
                <img src="{{ book.thumbnail }}" alt="{{ book.title }}"
                    class="w-full h-full object-cover transition-soft group-hover:scale-105">
                {% else %}
                <div class="w-full h-full flex items-center justify-center italic opacity-30 text-xs p-4 text-center">No
                    Cover Found</div>
                {% endif %}
            </div>
        </div>
        <div class="flex flex-col flex-1 py-1">
            <div class="flex-grow">
                <h3 class="text-2xl font-bold leading-tight mb-2">{{ book.title }}</h3>
                <p class="text-emerald-900 italic font-medium mb-4">{{ book.authors or 'Author Unknown' }}</p>
                {% if book.description %}
                <p class="text-sm opacity-60 line-clamp-4 leading-relaxed italic mb-4">"{{ book.description[:300]|safe
                    }}{%
                    if book.description|length > 300 %}...{% endif %}"</p>
                {% endif %}
            </div>
            <div class="mt-4 flex items-center justify-between border-t border-black/5 pt-4">
                <span class="text-[10px] opacity-40 uppercase tracking-widest">{{ book.categories or 'Miscellaneous'
                    }}</span>
                {% if current_user.is_authenticated %}
                <form action="{{ url_for('add_book', google_books_id=book.google_books_id) }}" method="POST">
                    <button type="submit"
                        class="text-xs uppercase tracking-widest font-bold hover:bg-black hover:text-white border border-black px-4 py-2 transition-soft">Acquire
                        Volume</button>
                </form>
                {% else %}
                <span class="text-[10px] italic opacity-30">Librarian access required to add</span>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% elif query %}
<div class="text-center py-32 opacity-30 italic">
    <p class="text-2xl">Alas, the archives remain silent on "{{ query }}".</p>
</div>
{% endif %}
{% endblock %}